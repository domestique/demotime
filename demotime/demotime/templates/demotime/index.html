{% extends 'base.html' %}
{% load demo_tags %}

{% block styles %}
{{ block.super }}
<link rel="stylesheet" href="/static/styles/index.css">
{% endblock %}

{% block content %}
<h1 class="heading">
    Dashboard
    <small><a href="{% url 'review-list' %}">View all open demos</a></small>
</h1>

<div class="reviews-list">

    <div class="quickfind">
        <form action="{% url 'review-list' %}#results" method="get">
            <input type="text" id="id_title" name="title" placeholder="Quickly find a demo or user by keyword">
            <div class="quickfind-results"><section>
                <div class="quickfind-reviews"></div>
                <div class="quickfind-users"></div>
            </section></div>
        </form>
    </div>

    <div class="split~680 by:2 with-gap:2">
        <div class="cel">
            {% include "includes/reviews_box.html" with reviews=open_reviews follows=followed_demos user=request.user %}
        </div>
        <div class="cel">
            {% include "includes/updates_box.html" with message_bundles=message_bundles user=request.user %}
        </div>
    </div>
    {% if open_demos %}
        {% include "includes/demos_box.html" with reviews=open_demos user=request.user %}
    {% endif %}
</div>

<div class="tip">
    <strong>Power tip</strong>: You can now simply type in {{ site_settings.SERVER_URL }}/DT-1234 to be redirected to a demo.
</div>
{% endblock %}

{% block patterns %}
{{ block.super }}
<script type="text/x-pattern" id="user_results">
<strong>Users</strong>
<ul>
<% if (user.length) { %>
    <% _.each(user, function(user) { %>
        <li><a href="/accounts/profile/<%= user.pk %>"><%= user.name %></a></li>
    <% }) %>
<% } else { %>
    <li>No matching users found</li>
<% } %>
</ul>
</script>
<script type="text/x-pattern" id="review_results">
<strong>Demos</strong>
<ul>
<% if (reviews.length) { %>
    <% _.each(reviews, function(review) { %>
        <li><a href="<%= review.url %>"><%= review.title %></a>, by <%= review.creator %></li>
    <% }) %>
<% } else { %>
    <li>No matching reviews found</li>
<% } %>
</ul>
</script>
{% endblock %}

{% block footer_scripts %}
<script src="/static/scripts/Search.js"></script>
{{ block.super }}
<script>
var search = new DemoTime.Search({
    review_url: '{% url 'reviews-json' %}',
    user_url: '{% url 'user-api' %}'
});
</script>
{% endblock %}
