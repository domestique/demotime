!function(e){"use strict";"function"==typeof define&&define.amd?define([],function(){return e(window,document)}):"undefined"!=typeof exports?module.exports=e(window,document):window.wysiwyg=e(window,document)}(function(e,t){"use strict";var n=function(e,t,n){var r;return function(){if(r){if(!n)return;clearTimeout(r)}var o=this,i=arguments;r=setTimeout(function(){r=null,e.apply(o,i)},t)}},r=function(t,n,r,o){t.addEventListener?t.addEventListener(n,r,!!o):t.attachEvent?t.attachEvent("on"+n,r):t!=e&&(t["on"+n]=r)},o=function(t,n,r,o){t.removeEventListener?t.removeEventListener(n,r,!!o):t.detachEvent?t.detachEvent("on"+n,r):t!=e&&(t["on"+n]=null)},i=function(e,n,r,o){if(t.createEvent){var i=t.createEvent("Event");i.initEvent(n,void 0!==r?r:!0,void 0!==o?o:!1),e.dispatchEvent(i)}else if(t.createEventObject){var i=t.createEventObject();e.fireEvent("on"+n,i)}else"function"==typeof e["on"+n]&&e["on"+n]()},a=function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,!1},l="undefined"!=typeof Node?Node.ELEMENT_NODE:1,u="undefined"!=typeof Node?Node.TEXT_NODE:3,f=function(e,t){for(var n=t;n;){if(n===e)return!0;n=n.parentNode}return!1},c=function(e,t){if(e.firstChild)return e.firstChild;for(;e;){if(e==t)return null;if(e.nextSibling)return e.nextSibling;e=e.parentNode}return null},s=function(n){if(e.getSelection){var r=e.getSelection();if(r.rangeCount>0)return r.getRangeAt(0)}else if(t.selection){var r=t.selection;return r.createRange()}return null},d=function(n,r){if(r)if(e.getSelection){var o=e.getSelection();o.removeAllRanges(),o.addRange(r)}else t.selection&&r.select()},p=function(){if(e.getSelection){var n=e.getSelection();if(!n.rangeCount)return!1;var r=n.getRangeAt(0).cloneRange();if(r.getBoundingClientRect){var o=r.getBoundingClientRect();if(o&&o.left&&o.top&&o.right&&o.bottom)return{left:parseInt(o.left),top:parseInt(o.top),width:parseInt(o.right-o.left),height:parseInt(o.bottom-o.top)};for(var i=r.getClientRects?r.getClientRects():[],a=0;a<i.length;++a){var o=i[a];if(o.left&&o.top&&o.right&&o.bottom)return{left:parseInt(o.left),top:parseInt(o.top),width:parseInt(o.right-o.left),height:parseInt(o.bottom-o.top)}}}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var r=n.createRange();if(r.boundingLeft||r.boundingTop||r.boundingWidth||r.boundingHeight)return{left:r.boundingLeft,top:r.boundingTop,width:r.boundingWidth,height:r.boundingHeight}}}return!1},g=function(n){if(e.getSelection){var r=e.getSelection();return!!r.isCollapsed}if(t.selection){var r=t.selection;if("Text"==r.type){var o=t.selection.createRange(),i=t.body.createTextRange();return i.moveToElementText(n),i.setEndPoint("EndToStart",o),0==o.htmlText.length}if("Control"==r.type)return!1}return!0},v=function(n){if(e.getSelection){var r=e.getSelection();if(!r.rangeCount)return[];for(var o=[],i=0;i<r.rangeCount;++i)for(var a=r.getRangeAt(i),u=a.startContainer,s=a.endContainer;u;){if(u!=n){var d=!1;if(r.containsNode)d=r.containsNode(u,!0);else{var p=t.createRange();p.selectNodeContents(u);for(var i=0;i<r.rangeCount;++i){var a=r.getRangeAt(i);if(a.compareBoundaryPoints(a.END_TO_START,p)>=0&&a.compareBoundaryPoints(a.START_TO_END,p)<=0){d=!0;break}}}d&&o.push(u)}u=c(u,u==s?s:n)}return 0==o.length&&f(n,r.focusNode)&&r.focusNode!=n&&o.push(r.focusNode),o}if(t.selection){var r=t.selection;if("Text"==r.type){for(var o=[],g=r.createRangeCollection(),i=0;i<g.length;++i)for(var a=g[i],v=a.parentElement(),u=v;u;){var p=a.duplicate();if(p.moveToElementText(u.nodeType!=l?u.parentNode:u),p.compareEndPoints("EndToStart",a)>=0&&p.compareEndPoints("StartToEnd",a)<=0){for(var h=!1,m=0;m<o.length;++m)if(o[m]===u){h=!0;break}h||o.push(u)}u=c(u,v)}return 0==o.length&&f(n,t.activeElement)&&t.activeElement!=n&&o.push(t.activeElement),o}if("Control"==r.type){for(var o=[],a=r.createRange(),i=0;i<a.length;++i)o.push(a(i));return o}}return[]},h=function(){if(e.getSelection){var n=e.getSelection();if(!n.isCollapsed)try{n.collapseToEnd()}catch(r){}}else if(t.selection){var n=t.selection;if("Control"!=n.type){var o=n.createRange();o.collapse(!1),o.select()}}},m=function(n,r,o){if(e.getSelection){var i=e.getSelection();if(i.modify){for(var a=0;r>a;++a)i.modify("extend","backward","character");for(var a=0;o>a;++a)i.modify("extend","forward","character")}else{var l=i.getRangeAt(0);l.setStart(l.startContainer,l.startOffset-r),l.setEnd(l.endContainer,l.endOffset+o),i.removeAllRanges(),i.addRange(l)}}else if(t.selection){var i=t.selection;if("Control"!=i.type){var l=i.createRange();l.collapse(!0),l.moveStart("character",-r),l.moveEnd("character",o),l.select()}}},y=function(n){if(g(n))return null;if(e.getSelection){var r=e.getSelection();if(r.rangeCount){for(var o=t.createElement("div"),i=r.rangeCount,a=0;i>a;++a){var l=r.getRangeAt(a).cloneContents();o.appendChild(l)}return o.innerHTML}}else if(t.selection){var r=t.selection;if("Text"==r.type){var u=r.createRange();return u.htmlText}}return null},T=function(n,r){if(e.getSelection){var o=e.getSelection();if(f(n,o.anchorNode)&&f(n,o.focusNode))return!0;if(!r)return!1;var i=t.createRange();i.selectNodeContents(n),i.collapse(!1),o.removeAllRanges(),o.addRange(i)}else if(t.selection){var o=t.selection;if("Control"==o.type){var i=o.createRange();if(0!=i.length&&f(n,i(0)))return!0}else{var a=t.body.createTextRange();a.moveToElementText(n);var i=o.createRange();if(a.inRange(i))return!0}if(!r)return!1;var i=t.body.createTextRange();i.moveToElementText(n),i.setEndPoint("StartToEnd",i),i.select()}return!0},b=function(n,r){if(e.getSelection){var o=e.getSelection();if(o.getRangeAt&&o.rangeCount){var i=o.getRangeAt(0),a=t.createElement("div");a.innerHTML=r;for(var l,u,c=t.createDocumentFragment();l=a.firstChild;)u=c.appendChild(l);f(n,i.commonAncestorContainer)?(i.deleteContents(),i.insertNode(c)):n.appendChild(c),u&&(i=i.cloneRange(),i.setStartAfter(u),i.collapse(!0),o.removeAllRanges(),o.addRange(i))}}else if(t.selection){var o=t.selection;if("Control"!=o.type){var s=o.createRange();s.collapse(!0);var i=o.createRange();if(f(n,i.parentElement()))i.pasteHTML(r);else{var d=t.body.createTextRange();d.moveToElementText(n),d.collapse(!1),d.select(),d.pasteHTML(r)}i=o.createRange(),i.setEndPoint("StartToEnd",s),i.select()}}},E=function(E){E=E||{};var C=E.element||null;"string"==typeof C&&(C=t.getElementById(C));var R=E.contenteditable||null;"string"==typeof R&&(R=t.getElementById(R));var S=E.onKeyDown||null,L=E.onKeyPress||null,N=E.onKeyUp||null,A=E.onSelection||null,x=E.onPlaceholder||null,M=E.onOpenpopup||null,w=E.onClosepopup||null,I=E.hijackContextmenu||!1,H=E.readOnly||!1,k="TEXTAREA"==C.nodeName||"INPUT"==C.nodeName;if(k){var O="contentEditable"in t.body;if(O){var P=navigator.userAgent.match(/(?:iPad|iPhone|Android).* AppleWebKit\/([^ ]+)/);P&&420<=parseInt(P[1])&&parseInt(P[1])<534&&(O=!1)}if(!O){var D=C,B=function(e){return e.replace(/<br[ \/]*>\n?/gi,"<br>\n")};D.value=B(D.value);var j=function(){return this},K=function(){return null};return{legacy:!0,getElement:function(){return D},getHTML:function(){return D.value},setHTML:function(e){return D.value=B(e),this},getSelectedHTML:K,sync:j,readOnly:function(e){return void 0===e?D.hasAttribute?D.hasAttribute("readonly"):!!D.getAttribute("readonly"):(e?D.setAttribute("readonly","readonly"):D.removeAttribute("readonly"),this)},collapseSelection:j,expandSelection:j,openPopup:K,closePopup:j,removeFormat:j,bold:j,italic:j,underline:j,strikethrough:j,forecolor:j,highlight:j,fontName:j,fontSize:j,subscript:j,superscript:j,align:j,format:j,indent:j,insertLink:j,insertImage:j,insertHTML:j,insertList:j}}}var D=null,X=null;if(k)if(D=C,D.style.display="none",R)X=R;else{X=t.createElement("DIV"),X.innerHTML=D.value||"";var W=D.parentNode,Y=D.nextSibling;Y?W.insertBefore(X,Y):W.appendChild(X)}else X=C;H||X.setAttribute("contentEditable","true");var _,F=t.all&&(!t.documentMode||t.documentMode<=8)?t:e,V=null;if(k){var q=X.innerHTML;V=function(){var e=X.innerHTML;e!=q&&(D.value=e,q=e,i(D,"change",!1))};var z=D.form;z&&r(z,"reset",function(){X.innerHTML="",V(),_(!0)})}var U;if(x){var G=!1;U=function(){for(var e=!0,t=X;t;)if(t=c(t,X)){if(t.nodeType==l){if("IMG"==t.nodeName){e=!1;break}}else if(t.nodeType==u){var n=t.nodeValue;if(n&&-1!=n.search(/[^\s]/)){e=!1;break}}}else;G!=e&&(x(e),G=e)},U()}var J=null,Q=null,Z=null;A&&(Q=function(t,n,r){var o=g(X),i=v(X),a=null===t||null===n?null:{left:t,top:n,width:0,height:0},u=p();if(u&&(a=u),a){if(X.getBoundingClientRect){var f=X.getBoundingClientRect();a.left-=parseInt(f.left),a.top-=parseInt(f.top)}else{var c=X,s=0,d=0,h=!1;do s+=c.offsetLeft?parseInt(c.offsetLeft):0,d+=c.offsetTop?parseInt(c.offsetTop):0,"fixed"==c.style.position&&(h=!0);while(c=c.offsetParent);a.left-=s-(h?0:e.pageXOffset),a.top-=d-(h?0:e.pageYOffset)}a.left<0&&(a.left=0),a.top<0&&(a.top=0),a.width>X.offsetWidth&&(a.width=X.offsetWidth),a.height>X.offsetHeight&&(a.height=X.offsetHeight)}else if(i.length)for(var m=0;m<i.length;++m){var c=i[m];if(c.nodeType==l){a={left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight};break}}A(o,a,i,r)},Z=n(Q,1));var $=null,ee=function(t){if(!t)var t=e.event;var n=t.target||t.srcElement;n.nodeType==u&&(n=n.parentNode),f($,n)||ne()},te=function(){if($)return $;r(F,"mousedown",ee,!0),$=t.createElement("DIV");var e=X.parentNode,n=X.nextSibling;return n?e.insertBefore($,n):e.appendChild($),M&&M(),$},ne=function(){$&&($.parentNode.removeChild($),$=null,o(F,"mousedown",ee,!0),w&&w())};r(X,"focus",function(){D&&i(D,"focus",!1)}),r(X,"blur",function(){V&&V(),D&&i(D,"blur",!1)});var re=null;if(U||V){var oe=V?n(V,250,!0):null,ie=function(e){U&&U(),oe&&oe()};re=n(ie,1),r(X,"input",re),r(X,"DOMNodeInserted",re),r(X,"DOMNodeRemoved",re),r(X,"DOMSubtreeModified",re),r(X,"DOMCharacterDataModified",re),r(X,"propertychange",re),r(X,"textInput",re),r(X,"paste",re),r(X,"cut",re),r(X,"drop",re)}var ae=function(t,n){if(!t)var t=e.event;var r=t.which||t.keyCode,o=String.fromCharCode(r||t.charCode),i=t.shiftKey||!1,l=t.altKey||!1,u=t.ctrlKey||!1,f=t.metaKey||!1;if(1==n){if(S&&S(r,o,i,l,u,f)===!1)return a(t)}else if(2==n){if(L&&L(r,o,i,l,u,f)===!1)return a(t)}else if(3==n&&N&&N(r,o,i,l,u,f)===!1)return a(t);if(2!=n&&3!=n||(J=null,Z&&Z(null,null,!1)),2==n&&re)switch(r){case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:break;default:re()}};r(X,"keydown",function(e){return ae(e,1)}),r(X,"keypress",function(e){return ae(e,2)}),r(X,"keyup",function(e){return ae(e,3)});var le=function(t,n){if(!t)var t=e.event;var r=null,i=null;t.clientX&&t.clientY?(r=t.clientX,i=t.clientY):t.pageX&&t.pageY&&(r=t.pageX-e.pageXOffset,i=t.pageY-e.pageYOffset),t.which&&3==t.which?n=!0:t.button&&2==t.button&&(n=!0),o(F,"mouseup",le),J=null,!I&&n||Z&&Z(r,i,n)};r(X,"mousedown",function(e){o(F,"mouseup",le),r(F,"mouseup",le)}),r(X,"mouseup",function(e){le(e),re&&re()}),r(X,"dblclick",function(e){le(e)}),r(X,"selectionchange",function(e){le(e)}),I&&r(X,"contextmenu",function(e){return le(e,!0),a(e)});var ue=function(n,r,o){if(d(X,J),X.focus(),!T(X,o))return!1;if(e.getSelection)try{return t.queryCommandSupported&&!t.queryCommandSupported(n)?!1:t.execCommand(n,!1,r)}catch(i){}else if(t.selection){var a=t.selection;if("None"!=a.type){var l=a.createRange();try{return l.queryCommandEnabled(n)?l.execCommand(n,!1,r):!1}catch(i){}}}return!1},fe=null,ce=function(){(t.all||e.MSInputMethodContext)&&(fe=t.createElement("DIV"),X.appendChild(fe))};return _=function(e){fe&&(X.removeChild(fe),fe=null),re&&re(),e?(h(),J=null):J&&(J=s(X))},{getElement:function(){return X},getHTML:function(){return X.innerHTML},setHTML:function(e){return X.innerHTML=e||"<br>",_(!0),this},getSelectedHTML:function(){return d(X,J),T(X)?y(X):null},sync:function(){return V&&V(),this},readOnly:function(e){return void 0===e?X.hasAttribute?!X.hasAttribute("contentEditable"):!X.getAttribute("contentEditable"):(e?X.removeAttribute("contentEditable"):X.setAttribute("contentEditable","true"),this)},collapseSelection:function(){return h(),J=null,this},expandSelection:function(e,t){return d(X,J),T(X)?(m(X,e,t),J=s(X),this):this},openPopup:function(){return J||(J=s(X)),te()},closePopup:function(){return ne(),this},removeFormat:function(){return ue("removeFormat"),ue("unlink"),_(),this},bold:function(){return ue("bold"),_(),this},italic:function(){return ue("italic"),_(),this},underline:function(){return ue("underline"),_(),this},strikethrough:function(){return ue("strikeThrough"),_(),this},forecolor:function(e){return ue("foreColor",e),_(),this},highlight:function(e){return ue("hiliteColor",e)||ue("backColor",e),_(),this},fontName:function(e){return ue("fontName",e),_(),this},fontSize:function(e){return ue("fontSize",e),_(),this},subscript:function(){return ue("subscript"),_(),this},superscript:function(){return ue("superscript"),_(),this},align:function(e){return ce(),"left"==e?ue("justifyLeft"):"center"==e?ue("justifyCenter"):"right"==e?ue("justifyRight"):"justify"==e&&ue("justifyFull"),_(),this},format:function(e){return ce(),ue("formatBlock",e),_(),this},indent:function(e){return ce(),ue(e?"outdent":"indent"),_(),this},insertLink:function(e){return ue("createLink",e),_(!0),this},insertImage:function(e){return ue("insertImage",e,!0),_(!0),this},insertHTML:function(e){return ue("insertHTML",e,!0)||(d(X,J),T(X,!0),b(X,e)),_(!0),this},insertList:function(e){return ce(),ue(e?"insertOrderedList":"insertUnorderedList"),_(),this}}};return E});
